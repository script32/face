<html>
  <head>   
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

     <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Ciclo Api Kycface</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename = 'style.css') }}">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>     

    <script> 
      $(document).ready(function () { 
          fetch('https://kycface.mooo.com/login', {
              method: 'POST',
              body: JSON.stringify({
                  username: 'test',
                  password: 'test',
              }),
              headers: {
                  'Content-Type': 'application/json; charset=utf-8',
                  'Accept': 'application/json',
                  "Authorization": 'Bearer ' + window.sessionStorage.getItem('token')
              }
          }).then(response => response.json())
            .then(function(data){
            
              window.sessionStorage.setItem('token', data.access_token);
              alert( window.sessionStorage.getItem('token'));
          })


          $('#sidebarCollapse').on('click', function () {
              $('#sidebar').toggleClass('active');
          });
          $("#image").hide();

          $.ajax({
                type: "POST",
                url: "https://kycface.mooo.com/kycfaceid/user/list",
                data: "{}",
                headers: {
                   'Content-Type': 'application/json; charset=utf-8',
                   'Accept': 'application/json',
                   'Authorization': 'Bearer ' + window.sessionStorage.getItem('token')
                },
                crossDomain: true,
                dataType: 'json',
                success: function(msg) {
                     var listItems = '<option selected="selected" value="0">- Select -</option>';
 
                    for (var i = 0; i < msg.length; i++) {
                           listItems += "<option value='" + msg[i].userId + "'>" + msg[i].namefull + "</option>";
                       }

                       $("#selnameFull").html(listItems);


                 
                },
                error: function() {
                    alert("No cargo usuarios");
                }
              });

            $( "#boton" ).click(function() {
               var user = $('#selnameFull').val();  
               var formDat;

               Webcam.snap(function(data_uri) {
                   formDat = Webcam.FormAddFace(data_uri);
                });
             
                areglo=encodeURIComponent(formDat); 


              $.ajax({
                    data : {
                      image : formDat,
                      userId: user
                    },
                     headers: {
                       'Content-Type': 'application/json; charset=utf-8',
                       'Accept': 'application/json',
                       'Authorization': 'Bearer ' + window.sessionStorage.getItem('token')
                     },
                    type : 'POST',
                    url : 'https://kycface.mooo.com/kycfaceid/user/addface'
                  })
                  .done(function(data) {

                    alert(data);

                  });
            
            });

          var form = $('#addFace');

                                         
      });

          


    </script>   
  </head>
  <body tcap-name="main">
    <div class="wrapper">
        <nav id="sidebar">
          <div class="sidebar-header">
            <h3>Ciclo Api Kycface {% print("Python") %}</h3>
          </div>
          <ul class="list-unstyled components">
            <p>Menu</p>  
            <li>
                <a href="/">Inicio</a>
            </li>           
            <li>
                <a href="/kycface/creargrupo">Crea Grupo</a>
            </li>           
            <li>
                <a href="/kycface/crearusuario">Crea Usuario</a>
            </li>
            <li>
                <a href="/kycface/enrolarusuario">Enrolar Usuario a Grupo</a>
            </li>
            <li>
                <a href="/kycface/anadircara">AÃ±adir Cara al Usuario</a>
            </li>
            <li>
                <a href="/kycface/detectarrostro">Reconocer Rostro</a>
            </li>
            <li>
                <a href="/kycface/stream">Stream Video</a>
            </li>
        </ul>
     </nav>

    <!-- Page Content -->
     <div id="content">     
         <nav class="navbar navbar-expand-lg navbar-light bg-light">   
            <h3>Ciclo Api Kycface</h3>  
          </nav>        
                
                <form id="addFace" enctype="multipart/form-data">                    
                    <label for="selecioneusuario1">Seleccione Usuario</label><hr>
                    <select id="selnameFull"></select><hr>  
                    <div id="webcam"></div>
                    <input type="hidden" id="test" name="test">
                    
                 </form>
                 <button id="boton" name="boton">Enviar </button>
            </div>
              
       
    </div>         
       <script type="text/javascript" src="{{ url_for('static', filename = 'webcam.js') }}"></script>
        <script type="text/javascript">
          Webcam.set({
                  width: 600,
                  height: 460,
                  image_format: 'png',
                  jpeg_quality: 90
              });
              Webcam.attach( '#webcam' );                            
        </script>
  </body>
</html>